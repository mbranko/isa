<project name="mbs2.predavanja" default="build.all">
  <property file="tomee.properties"/>
  <property name="javac.debug" value="on"/>
  <property environment="env"/>
  
  <path id="runtime.classpath">
    <fileset dir="lib/runtime" includes="**/*.jar"/>
  </path>
  <!--
  <path id="jpa.classpath">
    <fileset dir="client-libs/hibernate" includes="*.jar"/>
    <fileset dir="client-libs/mysql" includes="*.jar"/>
  </path>
  <path id="compile.classpath">
    <path refid="runtime.classpath"/>
    <fileset dir="compile-libs" includes="*.jar"/>
  </path>
  -->

  <target name="compile">
    <mkdir dir="bin"/>
    <mkdir dir="dist"/>
    <javac srcdir="src" destdir="bin" classpathref="compile.classpath" includeantruntime="false"/>
  </target>

  <target name="pr01" depends="compile">
    <mkdir dir="dist/pr01"/>
    <jar destfile="dist/pr01/Server.jar">
      <zipfileset dir="bin">
        <include name="mbs2/pr01/ServerMain.class"/>
        <include name="mbs2/pr01/Server.class"/>
        <include name="mbs2/pr01/ServerI.class"/>
      </zipfileset>
      <manifest>
        <attribute name="Main-Class" value="mbs2.pr01.ServerMain"/>
      </manifest>
    </jar>
    <jar destfile="dist/pr01/Client.jar">
      <zipfileset dir="bin">
        <include name="mbs2/pr01/Client.class"/>
        <include name="mbs2/pr01/ServerI.class"/>
      </zipfileset>
      <manifest>
        <attribute name="Main-Class" value="mbs2.pr01.Client"/>
      </manifest>
    </jar>
  </target>

  <target name="pr02" depends="compile">
    <mkdir dir="dist/pr02"/>
    <jar destfile="dist/pr02/Server.jar">
      <zipfileset dir="bin">
        <include name="mbs2/pr02/Compute.class"/>
        <include name="mbs2/pr02/ComputeServer.class"/>
        <include name="mbs2/pr02/Task.class"/>
      </zipfileset>
      <manifest>
        <attribute name="Main-Class" value="mbs2.pr02.ComputeServer"/>
      </manifest>
    </jar>
    <jar destfile="dist/pr02/Client.jar">
      <zipfileset dir="bin">
        <include name="mbs2/pr02/Compute.class"/>
        <include name="mbs2/pr02/Task.class"/>
        <include name="mbs2/pr02/Pi.class"/>
        <include name="mbs2/pr02/ComputeClient.class"/>
      </zipfileset>
      <manifest>
        <attribute name="Main-Class" value="mbs2.pr02.ComputeClient"/>
      </manifest>
    </jar>
    <copy file="src/mbs2/pr02/server.policy" todir="dist/pr02"/>
    <copy file="src/mbs2/pr02/client.policy" todir="dist/pr02"/>
  </target>

  <target name="pr03" depends="compile">
    <mkdir dir="dist/pr03"/>
    <jar destfile="dist/pr03/FileClient.jar">
      <zipfileset dir="bin">
        <include name="mbs2/pr03/FileClient.class"/>
      </zipfileset>
      <zipfileset src="lib/runtime/jndi/fscontext.jar"/>
      <zipfileset src="lib/runtime/jndi/providerutil.jar"/>
      <manifest>
        <attribute name="Main-Class" value="mbs2.pr03.FileClient"/>
      </manifest>
    </jar>
    <jar destfile="dist/pr03/DNSClient.jar">
      <zipfileset dir="bin">
        <include name="mbs2/pr03/DNSClient.class"/>
      </zipfileset>
      <manifest>
        <attribute name="Main-Class" value="mbs2.pr03.DNSClient"/>
      </manifest>
    </jar>
    <jar destfile="dist/pr03/LDAPClient.jar">
      <zipfileset dir="bin">
        <include name="mbs2/pr03/LDAPClient.class"/>
      </zipfileset>
      <manifest>
        <attribute name="Main-Class" value="mbs2.pr03.LDAPClient"/>
      </manifest>
    </jar>
  </target>
  
  <target name="build.all" depends="pr01,pr02,pr03" />

</project>